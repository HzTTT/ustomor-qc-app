{% extends "base.html" %}
{% block content %}
<div class="flex items-start justify-between gap-4 mb-4">
  <div>
    <h1 class="text-2xl font-semibold">我的聊天记录与质检</h1>
    <div class="text-sm text-slate-500 mt-1">仅展示归属于你的对话（由“客服绑定”或导入字段确定）</div>
  </div>
  <div class="flex items-center gap-2">
    {% if not only_flagged %}
      <a href="/my?only_flagged=1" class="px-3 py-2 rounded-xl bg-slate-900 text-white text-sm">只看需复核</a>
    {% else %}
      <a href="/my" class="px-3 py-2 rounded-xl border bg-white text-sm">查看全部</a>
    {% endif %}
  </div>
</div>

<div class="bg-white border rounded-2xl overflow-hidden">
  <table class="w-full text-sm">
    <thead class="bg-slate-50">
      <tr>
        <th class="text-left px-4 py-3">对话ID</th>
        <th class="text-left px-4 py-3">平台</th>
        <th class="text-left px-4 py-3">对话类型</th>
        <th class="text-left px-4 py-3">售前负面标签</th>
        <th class="text-left px-4 py-3">售后负面标签</th>
        <th class="text-left px-4 py-3">摘要</th>
        <th class="text-right px-4 py-3">操作</th>
      </tr>
    </thead>
    <tbody>
      {% for c in convos %}
        {% set a = latest_by_conv.get(c.id) %}
        <tr class="border-t {% if a and a.flag_for_review %}bg-red-50{% endif %}">
          <td class="px-4 py-3">{{ c.external_id }}</td>
          <td class="px-4 py-3">{{ c.platform }}</td>
          <td class="px-4 py-3">{{ a.dialog_type if a else "-" }}</td>
          <td class="px-4 py-3">{{ a.pre_negative_tags if a and a.pre_negative_tags else "-" }}</td>
          <td class="px-4 py-3">{{ a.after_negative_tags if a and a.after_negative_tags else "-" }}</td>
          <td class="px-4 py-3 text-slate-600">{{ (a.day_summary if a else "")[:60] }}{% if a and (a.day_summary or "")|length > 60 %}...{% endif %}</td>
          <td class="px-4 py-3 text-right"><a class="underline" href="/conversations/{{ c.id }}">查看对话</a></td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

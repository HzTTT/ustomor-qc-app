# 客服质检与培训（MVP）

这个仓库是一个**可直接跑起来的网站**，用于：
- 多角色登录（客服 / 客服主管 / 管理员）
- 导入“AI对话分析 JSON(txt)”生成报表批次
- 下钻到具体对话查看原始对话 + AI质检输出（与你的 Excel 字段对齐）
- 主管/管理员对“有问题的对话”创建训练任务，客服提交改写练习，主管评分反馈

> 这是你描述的项目架构的最小可用实现。后续你把第三方上传到桶的每日数据格式定下来后，只需要在导入逻辑里补一层**从桶拉取文件 + 解析映射**即可。

## 1) 一键运行（Docker Compose）

在仓库根目录执行：

```bash
docker compose up --build
```

打开：
- http://localhost:8000

默认管理员（登录用**用户名**）：**Sean** / **0357zaqxswcde**（见 docker-compose 的 `DEFAULT_ADMIN_USERNAME`、`DEFAULT_ADMIN_PASSWORD`）。  
若 `SEED_DEMO=1` 且数据库为空，会额外种子演示账号：admin、supervisor、agent1、agent2 等（当前启动流程通常先创建 Sean，故多数情况下仅存在管理员）。

## 2) 典型使用流程

1. 管理员/主管登录 -> “导入分析” -> 上传 JSON(txt)
2. 在批次报表中挑需要复核的对话 -> 进入“对话详情”
3. 在“训练任务”模块：给指定客服创建任务 -> 客服进入任务页提交改写练习 -> 主管评分与反馈
4. 查看"客服分析"报表 -> 多维度分析客服表现（日期/场景/满意度交叉分析）

## 3) 导入文件格式（与 Excel 字段对齐）

示例在 `data/sample_batch.json`。核心字段：
- `batch_meta`: 批次元信息（平台/日期/来源等）
- `conversations[]`: 每条对话（conversation_id、messages、analysis）

> 你提到“AI输出一个含10个对话分析的 json 的 txt，然后支持上传导入匹配对话”——本项目已支持。

## 4) 部署提示

- 当前映射端口：8000
- DB 为 PostgreSQL（compose 内置）
- 默认关闭自助注册（`OPEN_REGISTRATION=0`），管理员通过“账号管理”创建/重置子账号
- 你未来放到 relay 服务器上时：
  - 改 `APP_SECRET_KEY`
  - 需要“设备免登录”更久：改 `REMEMBER_EXPIRE_DAYS`（默认 7 天）
  - 上 HTTPS 后建议设 `COOKIE_SECURE=1`（否则会走明文 HTTP 也发送 cookie）
  - 用 Nginx 反代 + HTTPS

## 5) 你下一步最值得做的增强（建议）

- **把“问题对话”变成可配置规则**：比如评分阈值、问题类型、特定关键词、以及主管手动标记
- **建立“岗位能力画像”**：把问题归因映射到能力维度（共情/流程准确性/风险控制/表达力…），这样训练任务更有方向
- **从桶自动拉取**：每天定时扫描桶路径，自动导入并生成批次（再配一页“导入日志”）

---

如需我把它接上你后续的 COS/OSS（S3 兼容）数据导入与定时任务，我建议你提供一份你准备采用的最终 JSON（或第三方原始格式）样例即可。

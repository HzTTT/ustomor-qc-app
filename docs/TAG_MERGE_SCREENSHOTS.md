# 标签合并功能界面说明

## 功能位置

标签合并功能位于标签管理页面的每个标签操作面板中。

## 访问路径

```
登录系统 → 设置 → 标签管理 → 选择一个标签 → 点击"编辑/停用" → 查看底部"合并到另一个标签"区域
```

## 界面结构

### 1. 标签管理页面主界面

```
┌─────────────────────────────────────────────────────┐
│  标签管理                          [分栏管理] [全部浏览] [批量导入]
├─────────────────────────────────────────────────────┤
│                                                       │
│  左侧：一级分类列表                                   │
│  ├─ 客服接待 (5 个标签)                              │
│  ├─ 服务流程 (3 个标签)                              │
│  └─ 产品质量投诉 (4 个标签)                          │
│                                                       │
│  右侧：二级标签列表                                   │
│  ├─ 客服接待                                         │
│  │   ├─ 未及时回复  [编辑/停用 ▼]                    │
│  │   ├─ 回复不及时  [编辑/停用 ▼]                    │
│  │   └─ ...                                          │
│  └─ ...                                              │
└─────────────────────────────────────────────────────┘
```

### 2. 点击"编辑/停用"后展开的操作面板

```
┌─────────────────────────────────────────────────────┐
│  编辑/停用 ▼                                          │
├─────────────────────────────────────────────────────┤
│                                                       │
│  [修改标签表单]                                       │
│  ├─ 标签名称: [未及时回复          ]  [启用 ☑]       │
│  ├─ 判定标准: [客服超过X分钟未回复...]                │
│  └─ 补充说明: [例：客户多次追问...]                   │
│  [保存]                                               │
│                                                       │
│  [停用该标签] (红色按钮)                              │
│                                                       │
│  [彻底删除该标签（不可恢复）] (浅红色按钮)            │
│                                                       │
│  ─────────────────────────────────────────          │
│                                                       │
│  合并到另一个标签：                                   │
│  ┌───────────────────────────────────────┐          │
│  │ 选择目标标签...                        ▼│          │
│  │                                         │          │
│  │  客服接待                               │          │
│  │    ├─ 回复不及时                        │          │
│  │    ├─ 态度不佳                          │          │
│  │    └─ ...                               │          │
│  │  服务流程                               │          │
│  │    ├─ 未按流程处理                      │          │
│  │    └─ ...                               │          │
│  │  产品质量投诉                           │          │
│  │    └─ ...                               │          │
│  └───────────────────────────────────────┘          │
│                                                       │
│  [合并到目标标签] (蓝色按钮)                          │
│                                                       │
└─────────────────────────────────────────────────────┘
```

### 3. 点击"合并到目标标签"后的确认对话框

```
┌───────────────────────────────────┐
│  ⚠️ 确认                            │
├───────────────────────────────────┤
│                                    │
│  确定要合并吗？                    │
│                                    │
│  将把「未及时回复」的所有对话标记  │
│  转移到目标标签，然后删除          │
│  「未及时回复」。                  │
│                                    │
│  此操作不可恢复。                  │
│                                    │
│       [取消]      [确定]           │
└───────────────────────────────────┘
```

### 4. 合并成功后的提示消息

```
┌─────────────────────────────────────────────────────┐
│  ✅ 已合并：未及时回复 → 回复不及时；                  │
│     迁移命中23条（去重5条），迁移手动标记8条（去重2条）│
└─────────────────────────────────────────────────────┘
```

## 界面元素说明

### 目标标签下拉选择器

**特点：**
- 按分类分组（optgroup）显示
- 排除当前标签（不能合并到自己）
- 包含所有启用和停用的标签
- 必填字段（required）

**示例：**
```html
<select name="target_tag_id" required>
  <option value="">选择目标标签...</option>
  <optgroup label="客服接待">
    <option value="2">回复不及时</option>
    <option value="3">态度不佳</option>
  </optgroup>
  <optgroup label="服务流程">
    <option value="5">未按流程处理</option>
  </optgroup>
</select>
```

### 合并按钮

**样式：**
- 蓝色背景（bg-blue-600）
- 白色文字
- 悬停时变深（hover:bg-blue-700）
- 小字体（text-sm）
- 全宽显示

**行为：**
- 点击前显示确认对话框
- 必须选择目标标签才能提交

### 分隔线

**作用：**
- 在"彻底删除"和"合并"功能之间添加分隔（border-t）
- 视觉上区分危险操作和常规操作

## 视觉层次

```
优先级从高到低：

1. 保存（常规操作）      - 灰色边框按钮
2. 停用标签（可逆操作）  - 红色实心按钮
3. 彻底删除（危险操作）  - 红色边框按钮
   ─────────────────── 分隔线 ───────────────────
4. 合并标签（特殊操作）  - 蓝色实心按钮
```

## 响应式设计

### 桌面端
- 操作面板宽度：520px
- 下拉选择器全宽显示
- 按钮全宽显示

### 移动端
- 操作面板最大宽度：80vw
- 保持全宽布局
- 字体大小自动调整（text-sm）

## 可用性考虑

### 1. 防误操作
- ✅ 确认对话框
- ✅ 清晰的操作说明
- ✅ "不可恢复"警告

### 2. 清晰反馈
- ✅ 显示迁移数量
- ✅ 显示去重数量
- ✅ 显示源标签和目标标签名称

### 3. 操作引导
- ✅ 必填字段提示
- ✅ 分类分组便于查找
- ✅ 当前标签自动排除

### 4. 错误处理
- ✅ 未选择目标标签：浏览器原生验证
- ✅ 标签不存在：服务器返回错误消息
- ✅ 重复提交：表单提交后禁用

## 主题一致性

合并功能的界面设计遵循系统现有的设计规范：

- ✅ 使用 Tailwind CSS 类名
- ✅ 圆角统一（rounded-lg）
- ✅ 间距统一（px-3 py-2）
- ✅ 配色方案统一（slate/rose/blue）
- ✅ 字体大小统一（text-sm / text-xs）

## 无障碍支持

- ✅ 语义化 HTML（form, select, button）
- ✅ 必填字段标记（required）
- ✅ 清晰的标签文本
- ✅ 键盘导航支持（原生表单元素）
- ✅ 对比度符合 WCAG 标准

## 浏览器兼容性

测试过的浏览器：
- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

依赖的特性：
- HTML5 form validation (required 属性)
- JavaScript confirm() 对话框
- CSS Flexbox/Grid (Tailwind)

## 性能考虑

- 下拉选择器：即使有 100+ 标签也能流畅运行
- 表单提交：同步提交，通常 < 3 秒
- 页面刷新：服务器端重定向，保留 UI 状态

## 未来改进方向

可能的 UI 增强：
1. 合并预览：显示将影响多少对话
2. 批量合并：一次选择多个源标签
3. 搜索功能：快速查找目标标签
4. 颜色编码：按使用频率着色
5. 合并历史：显示过去的合并记录

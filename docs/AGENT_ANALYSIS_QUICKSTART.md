# 客服分析报表快速开始

## 一分钟上手

### 1. 访问报表

打开浏览器访问：
```
http://localhost:8000/reports/agent-analysis
```

或者点击主导航栏的 **"客服分析"** 按钮。

### 2. 查询数据

页面默认显示最近 7 天的数据，直接点击 **"查询"** 按钮即可查看。

### 3. 查看明细

- 点击客服名称前的 `▸` 图标，展开查看该客服的日期明细
- 继续点击日期前的 `▸`，展开查看各场景明细
- 再点击场景前的 `▸`，展开查看各满意度明细
- 点击满意度标签，弹窗查看具体对话列表

### 4. 自定义筛选

根据需要调整筛选条件：
- **分组方式**：按天/按周/按月
- **日期范围**：选择要分析的时间段
- **平台**：筛选特定平台（可选）
- **客服**：筛选特定客服（可选）

修改后点击 **"查询"** 刷新数据。

## 典型使用场景

### 场景 1：查看某个客服本周表现

1. 分组方式选择"按天"
2. 日期范围设置为本周（周一到今天）
3. 客服选择目标客服
4. 点击"查询"
5. 展开客服名称，查看每天的场景和满意度分布

### 场景 2：对比不同客服在同一场景的表现

1. 分组方式选择"按周"
2. 日期范围设置为最近一个月
3. 不限定客服（查看全部）
4. 点击"查询"
5. 依次展开各客服，对比"售前"场景的满意度分布

### 场景 3：追踪满意度下降的具体原因

1. 查询相关时间段的数据
2. 展开找到"大幅减少"或"小幅减少"的满意度明细
3. 点击满意度标签，查看对话列表
4. 点击 CID 预览对话，分析具体问题

## 数据解读

### 场景分类

- **售前**：咨询商品、询价、下单等
- **售后**：退换货、物流查询、投诉等
- **售前和售后**：一次对话同时涉及售前和售后
- **其他接待场景**：无法归类的特殊场景
- **无法判定**：AI 无法判定场景类型
- **未知**：未进行 AI 分析或字段为空

### 满意度变化

- **大幅增加**：用户从不满到满意，或从满意到非常满意
- **小幅增加**：用户满意度略有提升
- **无显著变化**：满意度基本持平
- **小幅减少**：用户满意度略有下降
- **大幅减少**：用户从满意到不满，或从中立到非常不满
- **无法判定**：AI 无法判定满意度变化
- **未知**：未进行 AI 分析或字段为空

### 汇总逻辑

- **客服汇总**：该客服在时间范围内的所有对话数
- **日期汇总**：该日期（或周/月）内的所有对话数
- **场景汇总**：该场景下所有满意度的对话数
- **满意度明细**：具体某个场景+满意度组合的对话数

## 注意事项

### 权限说明

- **管理员/主管**：可查看所有客服的数据
- **客服**：仅可查看自己的数据（客服筛选器自动限定）

### 数据要求

1. 对话必须已完成 AI 质检（有 `ConversationAnalysis` 记录）
2. 客服账号需要已绑定到站内用户（通过 `AgentBinding` 或 `agent_user_id`）
3. 场景和满意度字段有值（否则显示为"未知"）

### 性能提示

- 查询范围越大，数据量越大，加载时间越长
- 建议单次查询不超过 3 个月的数据
- 如需分析长时间段，可分批查询或使用按月分组

## 常见问题

**Q: 为什么看不到数据？**

A: 可能原因：
1. 对话尚未进行 AI 质检
2. 日期范围内没有符合条件的对话
3. 客服账号未绑定
4. 筛选条件过窄

解决方法：
- 扩大日期范围
- 移除平台和客服筛选
- 检查是否有 AI 质检记录
- 确认客服绑定状态

**Q: 统计数字是否准确？**

A: 报表统计口径：
- 每个对话仅统计最新的 AI 质检结果
- 优先使用客服绑定表（`AgentBinding`）映射客服
- 时间基准使用对话结束时间（无则用开始时间或上传时间）

**Q: 如何导出数据？**

A: 当前版本暂不支持导出，后续版本将添加 Excel 导出功能。临时方案：
- 使用浏览器的打印功能（Ctrl+P）
- 或使用截图工具保存报表
- 或通过数据库直接查询导出

**Q: 按周分组时，周从哪天开始？**

A: PostgreSQL 的 `date_trunc('week')` 默认周一为一周的开始。

## 更多帮助

- 功能文档：`docs/AGENT_ANALYSIS_REPORT.md`
- 测试指南：`docs/AGENT_ANALYSIS_TEST_GUIDE.md`
- 更新日志：`CHANGELOG_AGENT_ANALYSIS.md`

## 反馈与建议

如有问题或改进建议，请联系开发团队。
